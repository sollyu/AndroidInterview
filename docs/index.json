[{"categories":["å®‰å“"],"content":"Hugo å’Œ LoveIt ä¸­çš„ Emoji çš„ç”¨æ³•æŒ‡å—.","date":"2021-11-01","objectID":"/handler/","tags":["å®‰å“","Handler"],"title":"AndroidHandlerçŸ¥è¯†ç‚¹æ€»ç»“","uri":"/handler/"},{"categories":["å®‰å“"],"content":"ä¼˜è´¨æ–‡ç«  ğŸ‘ Androidå¼‚æ­¥é€šä¿¡ï¼šå›¾æ–‡è¯¦è§£Handlerå·¥ä½œåŸç†_Carsonå¸¦ä½ å­¦Android-CSDNåšå®¢ Android Handler æœºåˆ¶ï¼ˆä¸€ï¼‰ï¼šHandler è¿è¡Œæœºåˆ¶å®Œæ•´æ¢³ç† - ç°è‰²é£˜é›¶ - åšå®¢å›­ Android Handleræœºåˆ¶ - MessageQueueå¦‚ä½•å¤„ç†æ¶ˆæ¯_æœªå­æ¶µçš„åšå®¢-CSDNåšå®¢ Androidåº”ç”¨ç¨‹åºæ¶ˆæ¯å¤„ç†æœºåˆ¶ - SegmentFault æ€å¦ ","date":"2021-11-01","objectID":"/handler/:1:0","tags":["å®‰å“","Handler"],"title":"AndroidHandlerçŸ¥è¯†ç‚¹æ€»ç»“","uri":"/handler/"},{"categories":["å®‰å“"],"content":"å¸¸è§é—®é¢˜ æç¤º ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œå¯ä»¥å…ˆå°è¯•çš„å…ˆè‡ªæˆ‘å›ç­”ä¸€ä¸‹ï¼Œç‚¹å‡»é¢˜ç›®å³å¯æŸ¥çœ‹ç­”æ¡ˆã€‚ ä¸»çº¿ç¨‹ä¸ºä»€ä¹ˆä¸ç”¨åˆå§‹åŒ–Looperï¼Ÿ å› ä¸ºåº”ç”¨åœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­å°±å·²ç»åˆå§‹åŒ–ä¸»çº¿ç¨‹Looperäº†ã€‚ æ¯ä¸ªjavaåº”ç”¨ç¨‹åºéƒ½æ˜¯æœ‰ä¸€ä¸ªmainæ–¹æ³•å…¥å£ï¼ŒAndroidæ˜¯åŸºäºJavaçš„ç¨‹åºä¹Ÿä¸ä¾‹å¤–ã€‚Androidç¨‹åºçš„å…¥å£åœ¨ActivityThreadçš„mainæ–¹æ³•ä¸­ï¼š /** * mainæ–¹æ³•ä¸­å…ˆåˆå§‹åŒ–ä¸»çº¿ç¨‹Looperï¼Œ * æ–°å»ºActivityThreadå¯¹è±¡ï¼Œç„¶åå†å¯åŠ¨Looperï¼Œè¿™æ ·ä¸»çº¿ç¨‹çš„Looperåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™å°±è·‘èµ·æ¥äº†ã€‚ * æˆ‘ä»¬ä¸éœ€è¦å†å»åˆå§‹åŒ–ä¸»çº¿ç¨‹Looperã€‚ */ public static void main(String[] args) { ... // åˆå§‹åŒ–ä¸»çº¿ç¨‹Looper Looper.prepareMainLooper(); ... // æ–°å»ºä¸€ä¸ªActivityThreadå¯¹è±¡ ActivityThread thread = new ActivityThread(); thread.attach(false, startSeq); // è·å–ActivityThreadçš„Handlerï¼Œä¹Ÿæ˜¯ä»–çš„å†…éƒ¨ç±»H if (sMainThreadHandler == null) { sMainThreadHandler = thread.getHandler(); } ... Looper.loop(); // å¦‚æœloopæ–¹æ³•ç»“æŸåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºç»“æŸ throw new RuntimeException(\"Main thread loop unexpectedly exited\"); } ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹çš„Looperæ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä½†æ˜¯å´ä¸ä¼šANRï¼Ÿ å› ä¸ºAndroid çš„æ˜¯ç”±äº‹ä»¶é©±åŠ¨çš„ï¼Œlooper.loop() ä¸æ–­åœ°æ¥æ”¶äº‹ä»¶ã€å¤„ç†äº‹ä»¶ï¼Œæ¯ä¸€ä¸ªç‚¹å‡»è§¦æ‘¸æˆ–è€…è¯´Activityçš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯è¿è¡Œåœ¨ Looper.loop() çš„æ§åˆ¶ä¹‹ä¸‹ï¼Œå¦‚æœå®ƒåœæ­¢äº†ï¼Œåº”ç”¨ä¹Ÿå°±åœæ­¢äº†ã€‚åªèƒ½æ˜¯æŸä¸€ä¸ªæ¶ˆæ¯æˆ–è€…è¯´å¯¹æ¶ˆæ¯çš„å¤„ç†é˜»å¡äº† Looper.loop()ï¼Œè€Œä¸æ˜¯ Looper.loop() é˜»å¡å®ƒã€‚ ä¸»çº¿ç¨‹ä¸­çš„Looper.loop()æ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´ANR?_å¨å¨çš„ä¸“æ -CSDNåšå®¢ Handlerå¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨ï¼Ÿ æˆ‘ä»¬å¯ä»¥å‘ç°MessageQueueå…¶å®æ˜¯â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹ï¼ŒHandlerä¸æ–­åœ°æ”¾å…¥æ¶ˆæ¯ï¼ŒLooperä¸æ–­åœ°å–å‡ºï¼Œè¿™å°±æ¶‰åŠåˆ°æ­»é”é—®é¢˜ã€‚ å¦‚æœLooperæ‹¿åˆ°é”ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè€ŒHandleréœ€è¦æŠŠæ¶ˆæ¯æ”¾è¿›å»ï¼Œé”å´è¢«Looperæ‹¿ç€æ— æ³•å…¥é˜Ÿï¼Œè¿™å°±é€ æˆäº†æ­»é”ã€‚ Handleræœºåˆ¶çš„è§£å†³æ–¹æ³•æ˜¯å¾ªç¯åŠ é”ã€‚åœ¨MessageQueueçš„nextæ–¹æ³•ä¸­ï¼š Message next() { ... for (;;) { ... nativePollOnce(ptr, nextPollTimeoutMillis); synchronized (this) { ... } } } Handleræ˜¯å¦‚ä½•åˆ‡æ¢çº¿ç¨‹çš„ï¼Ÿ ä½¿ç”¨ä¸åŒçº¿ç¨‹çš„Looperå¤„ç†æ¶ˆæ¯ã€‚ Handlerçš„é˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ Handlerçš„é˜»å¡å”¤é†’æœºåˆ¶æ˜¯åŸºäºLinuxçš„é˜»å¡å”¤é†’æœºåˆ¶ï¼Œä¸»è¦çš„å”¤é†’æœºåˆ¶æ˜¯epoll_waitå‡½æ•°ã€‚ è¿™ä¸ªæœºåˆ¶ä¹Ÿæ˜¯ç±»ä¼¼äºhandleræœºåˆ¶çš„æ¨¡å¼ã€‚åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åéœ€è¦ç­‰å¾…çš„ä¸€æ–¹åˆ™ç›‘å¬è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå”¤é†’çš„ä¸€æ–¹åªéœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç­‰å¾…çš„ä¸€æ–¹å°±ä¼šæ”¶åˆ°æ–‡ä»¶ä»è€Œæ‰“ç ´å”¤é†’ã€‚å’ŒLooperç›‘å¬MessageQueueï¼ŒHandleræ·»åŠ messageæ˜¯æ¯”è¾ƒç±»ä¼¼çš„ã€‚ æºç èŒ¶èˆä¹‹æ²¡æœ‰epollå°±æ²¡æœ‰Handler - æ˜é‡‘ èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageåŠ æ€¥è¢«å¤„ç†ï¼Ÿ/ ä»€ä¹ˆæ˜¯HandleråŒæ­¥å±éšœï¼Ÿ å¯ä»¥ / ä¸€ç§ä½¿å¾—å¼‚æ­¥æ¶ˆæ¯å¯ä»¥è¢«æ›´å¿«å¤„ç†çš„æœºåˆ¶ æ³¨æ„ï¼ŒåŒæ­¥å±éšœä¸ä¼šè‡ªåŠ¨ç§»é™¤ï¼Œä½¿ç”¨å®Œæˆä¹‹åéœ€è¦æ‰‹åŠ¨è¿›è¡Œç§»é™¤ï¼Œä¸ç„¶ä¼šé€ æˆåŒæ­¥æ¶ˆæ¯æ— æ³•è¢«å¤„ç†ã€‚ æ¶ˆæ¯å±éšœå¯åŠ¨ã€å…³é—­çš„æ–¹æ³•ï¼š // åå°„æ’å…¥æ¶ˆæ¯å±éšœ MessageQueue queue = mHandler.getLooper().getQueue(); Method method = MessageQueue.class.getDeclaredMethod(\"postSyncBarrier\"); method.setAccessible(true); token = (int)method.invoke(queue); // åå°„ç§»é™¤æ¶ˆæ¯å±éšœ MessageQueue queue = mHandler.getLooper().getQueue(); Method method = MessageQueue.class.getDeclaredMethod(\"removeSyncBarrier\", int.class); method.setAccessible(true); method.invoke(queue, token); Handlerä¹‹æ¶ˆæ¯å±éšœä½ åº”è¯¥çŸ¥é“çš„_å¤©äº®äº†çš„åšå®¢-CSDNåšå®¢_handleræ¶ˆæ¯å±éšœ ä¸€ä¸ªThreadå¯ä»¥æœ‰å‡ ä¸ªLooperï¼Ÿå‡ ä¸ªHandlerï¼Ÿ ä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªLooperï¼Œå¯ä»¥æœ‰å¤šä¸ªHandlerï¼Œ åœ¨çº¿ç¨‹ä¸­æˆ‘ä»¬éœ€è¦è°ƒç”¨Looper.perpare, ä»–ä¼šåˆ›å»ºä¸€ä¸ªLooperå¹¶ä¸”å°†Looperä¿å­˜åœ¨ThreadLocalä¸­ï¼Œ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªLocalThreadMapï¼Œä¼šå°†Looperä¿å­˜åœ¨å¯¹åº”çº¿ç¨‹ä¸­çš„LocalThreadMapï¼Œ keyä¸ºThreadLocalï¼Œvalueä¸ºLooper Messageå¯ä»¥å¦‚ä½•åˆ›å»ºï¼Ÿå“ªç§æ•ˆæœæ›´å¥½ï¼Œä¸ºä»€ä¹ˆ // æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡Messageçš„æ— å‚æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªMessage å¯¹è±¡ Message message = new Message(); // Message.obtain()åŠå…¶ç³»åˆ—çš„é‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä»–çš„æ— å‚æ–¹æ³•çš„æºç å®ç° Message message = Message.obtain(); public static Message obtain() { synchronized (sPoolSync) { if (sPool != null) { //ç›´æ¥ä»æœ¬åœ°è·å–ä¸€ä¸ªmessageå¯¹è±¡ Message m = sPool; sPool = m.next; m.next = null; m.flags = 0; // clear in-use flag //æ²¡è°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œå°±å°†æ–°çš„messageå¯¹è±¡åŠ å…¥Messageæ± å­ï¼ŒsPoolSizeå°±å‡å°‘ä¸€ä¸ª sPoolSize--; return m; } } return new Message(); } // new Handler().obtainMessage()åŠå…¶ç³»åˆ—çš„é‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä»–çš„æ— å‚æ–¹æ³•çš„æºç å®ç°ï¼š Message message = new Handler().obtainMessage(); public final Message obtainMessage(){ return Message.obtain(this); } // Message.obtain(this)æ–¹æ³•å…·ä½“ å¦‚ä¸‹ï¼š public static Message obtain(Handler h) { //æ–¹æ³•å†…éƒ¨æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†obtain()æ–¹æ³•ï¼Œåˆå›åˆ°,äº†æ–¹å¼2ï¼Œè¿™è·Ÿæ–¹å¼2åˆ›å»ºMessageå¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚ Message m = obtain(); m.target = h; return m; } Handleræ˜¯å¦‚ä½•å®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æŒ‰æ¶ˆæ¯è§¦å‘æ—¶é—´æ’åºçš„ è®¾ç½®epoll_waitçš„è¶…æ—¶æ—¶é—´ï¼Œä½¿å…¶åœ¨ç‰¹å®šæ—¶é—´å”¤é†’ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆè®¡ç®—å½“å‰æ—¶é—´å’Œè§¦å‘æ—¶é—´æœ‰å¤šé•¿ï¼Œè¿™ä¸ªå·®å€¼ä½œä¸º epoll_waitçš„è¶…æ—¶æ—¶é—´ï¼Œepoll_waitè¶…æ—¶çš„æ—¶å€™å°±æ˜¯æ¶ˆæ¯è§¦å‘çš„æ—¶å€™äº†ï¼Œå°±ä¸ä¼šç»§ç»­å µå¡ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«å”¤é†’ï¼Œå»æ‰§è¡Œæ¶ˆæ¯å¤„ç† ğŸ‘ æ·±å…¥ç†è§£Handler(ä¸‰) â€” Handlerå‘é€å»¶æ—¶æ¶ˆæ¯å®ç°_sosoå¯†æ–¯å¯†æ–¯çš„åšå®¢-CSDNåšå®¢ Handleræ˜¯å¦‚ä½•å®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ - ç®€ä¹¦ Handlerå‘é€æ¶ˆæ¯çš„ Delay å¯é å—ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸é è°±çš„ï¼Œå¼•èµ·ä¸é è°±çš„åŸå› æœ‰å¦‚ä¸‹ å‘é€çš„æ¶ˆæ¯å¤ªå¤š,Looperè´Ÿè½½è¶Šé«˜ï¼Œä»»åŠ¡è¶Šå®¹æ˜“ç§¯å‹ï¼Œè¿›è€Œå¯¼è‡´å¡é¡¿ æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä¸€äº›æ¶ˆæ¯å¤„ç†éå¸¸è€—æ—¶ï¼Œå¯¼è‡´åé¢çš„æ¶ˆæ¯å»¶æ—¶å¤„ç† å¤§äºHandler Looperçš„å‘¨æœŸæ—¶åŸºæœ¬å¯é ï¼ˆä¾‹å¦‚ä¸»çº¿ç¨‹\u003e50msï¼‰ å¯¹äºæ—¶é—´ç²¾ç¡®åº¦è¦æ±‚è¾ƒé«˜ï¼Œä¸è¦ç”¨handlerçš„delayä½œä¸ºå³æ—¶çš„ä¾æ® hreadã€Handlerå’ŒHandlerThreadå…³ç³»ä½•åœ¨ï¼Ÿ Handlerï¼šåœ¨androidä¸­è´Ÿè´£å‘é€å’Œå¤„ç†æ¶ˆæ¯ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°å…¶ä»–æ”¯çº¿çº¿ç¨‹ä¸ä¸»çº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯é€šè®¯ã€‚ Threadï¼šJavaè¿›ç¨‹ä¸­æ‰§è¡Œè¿ç®—çš„æœ€å°å•ä½ï¼Œäº¦å³æ‰§è¡Œå¤„ç†æœºè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚æŸä¸€è¿›ç¨‹ä¸­ä¸€è·¯å•ç‹¬è¿è¡Œçš„ç¨‹åºã€‚ HandlerThreadï¼šä¸€ä¸ªç»§æ‰¿è‡ªThreadçš„ç±»HandlerThreadï¼ŒAndroidä¸­æ²¡æœ‰å¯¹Javaä¸­çš„Threadè¿›è¡Œä»»ä½•å°è£…ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªç»§æ‰¿è‡ªThreadçš„ç±»HandlerThreadç±»ï¼Œè¿™ä¸ªç±»å¯¹Javaçš„Threadåšäº†å¾ˆå¤šä¾¿åˆ©çš„å°è£…ã€‚ ","date":"2021-11-01","objectID":"/handler/:2:0","tags":["å®‰å“","Handler"],"title":"AndroidHandlerçŸ¥è¯†ç‚¹æ€»ç»“","uri":"/handler/"},{"categories":["å®‰å“"],"content":"è§†é¢‘èµ„æ–™ ","date":"2021-11-01","objectID":"/handler/:3:0","tags":["å®‰å“","Handler"],"title":"AndroidHandlerçŸ¥è¯†ç‚¹æ€»ç»“","uri":"/handler/"},{"categories":["å®‰å“"],"content":"Hugo å’Œ LoveIt ä¸­çš„ Emoji çš„ç”¨æ³•æŒ‡å—.","date":"2021-11-01","objectID":"/view/","tags":["å®‰å“","æ¸²æŸ“","ç»˜åˆ¶","View"],"title":"AndroidViewç»˜åˆ¶æµç¨‹çŸ¥è¯†ç‚¹æ€»ç»“","uri":"/view/"},{"categories":["å®‰å“"],"content":"ä¼˜è´¨æ–‡ç«  Android Viewçš„ç»˜åˆ¶æµç¨‹çŸ¥è¯†ç‚¹æ€»ç»“ - çŸ¥ä¹ Android Viewçš„ç»˜åˆ¶æµç¨‹ - ç®€ä¹¦ Android Viewç»˜åˆ¶ä¸‰å¤§æµç¨‹æ¢ç´¢åŠå¸¸è§é—®é¢˜_æ¢¦å·¥å‚-CSDNåšå®¢ Android ViewçŸ¥è¯†ç‚¹é¢è¯•é¢˜_lizhong-CSDNåšå®¢ Android é¢è¯•æ€»ç»“ä¹‹å¸ƒå±€å¸¸è§é—®é¢˜ - ç¨‹åºå‘˜å¤§æœ¬è¥ ","date":"2021-11-01","objectID":"/view/:1:0","tags":["å®‰å“","æ¸²æŸ“","ç»˜åˆ¶","View"],"title":"AndroidViewç»˜åˆ¶æµç¨‹çŸ¥è¯†ç‚¹æ€»ç»“","uri":"/view/"},{"categories":["å®‰å“"],"content":"å¸¸è§é—®é¢˜ æç¤º ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œå¯ä»¥å…ˆå°è¯•çš„å…ˆè‡ªæˆ‘å›ç­”ä¸€ä¸‹ï¼Œç‚¹å‡»é¢˜ç›®å³å¯æŸ¥çœ‹ç­”æ¡ˆã€‚ ä»€ä¹ˆæ˜¯Viewï¼Ÿ ç®€å•æ¥è¯´ï¼ŒViewæ˜¯Androidç³»ç»Ÿåœ¨å±å¹•ä¸Šçš„è§†è§‰å‘ˆç°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨æ‰‹æœºå±å¹•ä¸Šçœ‹åˆ°çš„ä¸œè¥¿éƒ½æ˜¯Viewã€‚ Viewçš„ç»˜åˆ¶æµç¨‹åˆ†å‡ æ­¥ï¼Œä»å“ªå¼€å§‹ï¼Ÿå“ªä¸ªè¿‡ç¨‹ç»“æŸä»¥åèƒ½çœ‹åˆ°viewï¼Ÿ ä»ViewRootçš„performTraversalså¼€å§‹ï¼Œç»è¿‡measureï¼Œlayout,draw ä¸‰ä¸ªæµç¨‹ã€‚drawæµç¨‹ç»“æŸä»¥åå°±å¯ä»¥åœ¨å±å¹•ä¸Šçœ‹åˆ°viewäº†ã€‚ Viewçš„æµ‹é‡å®½é«˜å’Œå®é™…å®½é«˜æœ‰åŒºåˆ«å—ï¼Ÿ åŸºæœ¬ä¸Šç™¾åˆ†ä¹‹99çš„æƒ…å†µä¸‹éƒ½æ˜¯å¯ä»¥è®¤ä¸ºæ²¡æœ‰åŒºåˆ«çš„ã€‚ æœ‰ä¸¤ç§æƒ…å†µï¼Œæœ‰åŒºåˆ«ã€‚ ç¬¬ä¸€ç§ å°±æ˜¯æœ‰çš„æ—¶å€™ä¼šå› ä¸ºæŸäº›åŸå›  viewä¼šå¤šæ¬¡æµ‹é‡ï¼Œé‚£ç¬¬ä¸€æ¬¡æµ‹é‡çš„å®½é«˜ è‚¯å®šå’Œæœ€åå®é™…çš„å®½é«˜ æ˜¯ä¸ä¸€å®šç›¸ç­‰çš„ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹æœ€åä¸€æ¬¡æµ‹é‡çš„å®½é«˜å’Œå®é™…å®½é«˜æ˜¯ä¸€è‡´çš„ã€‚ æ­¤å¤–ï¼Œå®é™…å®½é«˜æ˜¯åœ¨layoutæµç¨‹é‡Œç¡®å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨layoutæµç¨‹é‡Œ å°†å®é™…å®½é«˜å†™æ­» å†™æˆç¡¬ç¼–ç ï¼Œè¿™æ ·æµ‹é‡çš„å®½é«˜å’Œå®é™…å®½é«˜å°±è‚¯å®šä¸ä¸€æ ·äº†ï¼Œè™½ç„¶è¿™ä¹ˆåšæ²¡æœ‰æ„ä¹‰ è€Œä¸”ä¹Ÿä¸å¥½ã€‚ Viewçš„measureSpec ç”±è°å†³å®š?é¡¶çº§viewå‘¢ï¼Ÿ ç”±viewè‡ªå·±çš„layoutparamså’Œçˆ¶å®¹å™¨ ä¸€èµ·å†³å®šè‡ªå·±çš„measureSpecã€‚ ä¸€æ—¦ç¡®å®šäº†specï¼ŒonMeasureä¸­å°±å¯ä»¥ç¡®å®šviewçš„å®½é«˜äº†ã€‚ é¡¶çº§viewå°±ç¨å¾®ç‰¹æ®Šä¸€ç‚¹ï¼Œå¯¹äºdecorViewçš„æµ‹é‡åœ¨ViewRootImplçš„æºç é‡Œã€‚ //desireçš„è¿™2ä¸ªå‚æ•°å°±ä»£è¡¨å±å¹•çš„å®½é«˜ï¼Œ childWidthMeasureSpec = getRootMeasureSpec(desiredWindowWidth, lp.width); childHeightMeasureSpec = getRootMeasureSpec(desiredWindowHeight, lp.height); performMeasure(childWidthMeasureSpec, childHeightMeasureSpec); //decorViewçš„measureSpecå°±æ˜¯åœ¨è¿™é‡Œç¡®å®šçš„ï¼Œå…¶å®æ¯”æ™®é€šviewçš„measurespecè¦ç®€å•çš„å¤š //ä»£ç å°±ä¸åˆ†æäº† ä¸€ç›®äº†ç„¶çš„ä¸œè¥¿ private static int getRootMeasureSpec(int windowSize, int rootDimension) { int measureSpec; switch (rootDimension) { case ViewGroup.LayoutParams.MATCH_PARENT: // Window can't resize. Force root view to be windowSize. measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY); break; case ViewGroup.LayoutParams.WRAP_CONTENT: // Window can resize. Set max size for root view. measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST); break; default: // Window wants to be an exact size. Force root view to be that size. measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY); break; } return measureSpec; } ViewGroupæœ‰onMeasureæ–¹æ³•å—ï¼Ÿä¸ºä»€ä¹ˆ? æ²¡æœ‰ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯äº¤ç»™å­ç±»è‡ªå·±å®ç°çš„ã€‚ä¸åŒçš„viewgroupå­ç±» è‚¯å®šå¸ƒå±€éƒ½ä¸ä¸€æ ·ï¼Œé‚£onMeasureç´¢æ€§å°±å…¨éƒ¨äº¤ç»™ä»–ä»¬è‡ªå·±å®ç°å¥½äº†ã€‚ layoutå’ŒonLayoutæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ layoutæ˜¯ç¡®å®šæœ¬èº«viewçš„ä½ç½® è€ŒonLayoutæ˜¯ç¡®å®šæ‰€æœ‰å­å…ƒç´ çš„ä½ç½®ã€‚layouté‡Œé¢ å°±æ˜¯é€šè¿‡serFrameæ–¹æ³•è®¾è®¾å®šæœ¬èº«viewçš„ å››ä¸ªé¡¶ç‚¹çš„ä½ç½®ã€‚è¿™4ä¸ªä½ç½®ä»¥ç¡®å®š è‡ªå·±viewçš„ä½ç½®å°±å›ºå®šäº†ï¼Œç„¶åå°±è°ƒç”¨onLayoutæ¥ç¡®å®šå­å…ƒç´ çš„ä½ç½®ã€‚viewå’Œviewgroupçš„onlayoutæ–¹æ³•éƒ½æ²¡æœ‰å†™ã€‚éƒ½ç•™ç»™æˆ‘ä»¬è‡ªå·±ç»™å­å…ƒç´ å¸ƒå±€ drawæ–¹æ³• å¤§æ¦‚æœ‰å‡ ä¸ªæ­¥éª¤ï¼Ÿ ä¸€å…±æ˜¯4ä¸ªæ­¥éª¤ï¼Œ ç»˜åˆ¶èƒŒæ™¯â€”â€”â€”ç»˜åˆ¶è‡ªå·±â€”â€”â€“ç»˜åˆ¶chrildrenâ€”-ç»˜åˆ¶è£…é¥°ã€‚ Viewå’ŒViewGroupä»€ä¹ˆåŒºåˆ«ï¼Ÿ Androidçš„UIç•Œé¢éƒ½æ˜¯ç”±Viewå’ŒViewGroupåŠå…¶æ´¾ç”Ÿç±»ç»„åˆè€Œæˆçš„ã€‚å…¶ä¸­ï¼ŒViewæ˜¯æ‰€æœ‰UIç»„ä»¶çš„åŸºç±»ï¼Œè€ŒViewGroupæ˜¯å®¹çº³è¿™äº›ç»„ä»¶çš„å®¹å™¨ï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯ä»Viewæ´¾ç”Ÿå‡ºæ¥çš„ã€‚AndroidUIç•Œé¢çš„ä¸€èˆ¬ç»“æ„ï¼š ","date":"2021-11-01","objectID":"/view/:2:0","tags":["å®‰å“","æ¸²æŸ“","ç»˜åˆ¶","View"],"title":"AndroidViewç»˜åˆ¶æµç¨‹çŸ¥è¯†ç‚¹æ€»ç»“","uri":"/view/"},{"categories":["å®‰å“"],"content":"è§†é¢‘èµ„æ–™ ","date":"2021-11-01","objectID":"/view/:3:0","tags":["å®‰å“","æ¸²æŸ“","ç»˜åˆ¶","View"],"title":"AndroidViewç»˜åˆ¶æµç¨‹çŸ¥è¯†ç‚¹æ€»ç»“","uri":"/view/"}]